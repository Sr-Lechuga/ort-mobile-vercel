# Resumen de Sesi√≥n - 09 de Octubre, 2025

## Objetivo

Revisi√≥n y actualizaci√≥n completa del archivo `swagger.json` para asegurar que la documentaci√≥n de la API est√© alineada con los modelos de datos, schemas de validaci√≥n y rutas actuales del proyecto.

## Tareas Completadas

### 1. Correcci√≥n de Schema de Validaci√≥n (inscriptionAttendance.schema.js)

**Archivo modificado:** `Backend/src/2_middlewares/request_schemas/inscriptionAttendance.schema.js`

**Cambios realizados:**

- Convertido el schema de JSON Schema b√°sico a Joi para mantener consistencia con el resto del proyecto
- Agregados mensajes de error personalizados en espa√±ol
- El schema ahora valida correctamente el campo `assisted` como booleano requerido

**Raz√≥n:** Todos los dem√°s schemas de validaci√≥n del proyecto usan Joi, por lo que este archivo deb√≠a ser actualizado para mantener la consistencia.

---

### 2. Verificaci√≥n de Consistencia entre Modelos y Schemas

**Archivos revisados:**

- `Backend/src/models/activityInstance.model.js`
- `Backend/src/2_middlewares/request_schemas/activityInstanceRequest.schema.js`
- `Backend/src/models/inscription.model.js`
- `Backend/src/models/activity.model.js`

**Resultado:** Los schemas de validaci√≥n est√°n correctamente alineados con los modelos de Mongoose.

---

### 3. Actualizaci√≥n Completa de swagger.json

#### 3.1. Nuevos Endpoints Agregados

**PATCH /v1/actividades**

- Permite actualizar una actividad existente
- Requiere autenticaci√≥n de organizador y ser propietario
- Valida con `ActivityPatchRequest`

**PATCH /v1/actividades/{activityId}/instancias/{instanceId}**

- Permite actualizar una instancia de actividad
- Requiere autenticaci√≥n de organizador y ser propietario
- Valida con `ActivityInstancePatchRequest`

**PATCH /v1/actividades/{activityId}/instancias/{instanceId}/inscripciones/{inscriptionId}/asistencia**

- Permite al organizador marcar la asistencia de un voluntario
- Requiere autenticaci√≥n de organizador y ser propietario de la actividad
- Valida con `InscriptionAttendanceRequest`

**DELETE /v1/voluntarios/inscripciones/{inscriptionId}**

- Permite a un voluntario cancelar su inscripci√≥n
- Requiere autenticaci√≥n de voluntario

#### 3.2. Correcci√≥n de Endpoints Existentes

**POST /v1/actividades/{activityId}/instancias/{instanceId}/inscripciones**

- Correcci√≥n del path: cambiado de `/inscriptions` a `/inscripciones` para mantener consistencia con las rutas en espa√±ol
- Agregada respuesta con schema `InscriptionResponse`

#### 3.3. Nuevos Tags

- Agregado tag **"Inscripciones"** para organizar mejor los endpoints relacionados con inscripciones de voluntarios

#### 3.4. Nuevos Schemas de Componentes

**ActivityInstancePatchRequest**

- Schema para actualizar instancias de actividad
- Campos opcionales: `date`, `duration`, `inscriptionsOpen`, `slots`
- Alineado con el modelo `activityInstance.model.js`

**ActivityPatchRequest**

- Schema para actualizar actividades
- Campos requeridos: `title`, `categories`, `location`, `locationCoordinates`
- Campos opcionales: `description`, `status`

**InscriptionAttendanceRequest**

- Schema para marcar asistencia
- Campo requerido: `assisted` (boolean)

**InscriptionResponse**

- Schema de respuesta al crear una inscripci√≥n
- Incluye mensaje y objeto inscripci√≥n

**Inscription**

- Schema completo del modelo de inscripci√≥n
- Campos: `_id`, `volunteer`, `instance`, `accepted`, `date`, `assisted`, `createdAt`, `updatedAt`

#### 3.5. Schemas Actualizados

**ActivityInstanceRequest**

- Actualizado para reflejar el modelo real
- Eliminado campo `status` (no existe en el modelo)
- Cambiado `quota` por `slots`
- Agregado `inscriptionsOpen`
- Campos requeridos: `date`, `duration`

**ActivityInstance**

- Actualizado completamente para reflejar el modelo de Mongoose
- Campos corregidos:
  - Eliminado: `status`, `inscriptionsAmount`, `quota`
  - Agregados: `inscriptionsOpen`, `slots`, `inscriptions` (array de IDs)

**ActivityRequest**

- Actualizado el enum de `status` a solo `["inactiva", "en curso"]`
- Corregida descripci√≥n de `date` para indicar actualizaci√≥n autom√°tica

**Activity**

- Actualizado el campo `instances` para reflejar que es un array de IDs (strings)
- Actualizado enum de `status` a `["inactiva", "en curso"]`

#### 3.6. Correcci√≥n de Estados y Categor√≠as

Seg√∫n el archivo `Backend/src/utils/constants.js`:

**Estados de Actividad (ACTIVITY_STATUS):**

- Antes: `["inactiva", "programado", "cerrado", "en curso", "finalizado"]`
- Ahora: `["inactiva", "en curso"]`

**Categor√≠as (ACTIVITY_CATEGORIES):**

- Mantenidas: `["social", "ambiental", "educativo", "cultural", "salud", "emergencia"]` ‚úì

**G√©neros de Voluntario (VOLUNTEER_GENRE):**

- Mantenidos: `["hombre", "mujer", "no especificado"]` ‚úì

---

## Archivos Modificados

1. **Backend/src/2_middlewares/request_schemas/inscriptionAttendance.schema.js** - Convertido a Joi
2. **Backend/swagger.json** - Actualizaci√≥n completa de documentaci√≥n

---

## Impacto de los Cambios

### Positivo

‚úÖ La documentaci√≥n Swagger ahora refleja con precisi√≥n todos los endpoints disponibles  
‚úÖ Los schemas de request/response est√°n alineados con los modelos de Mongoose  
‚úÖ Los estados y categor√≠as coinciden con las constantes definidas en el c√≥digo  
‚úÖ Consistencia total en el uso de Joi para validaci√≥n de requests  
‚úÖ Mejor organizaci√≥n con el nuevo tag "Inscripciones"

### A Considerar

‚ö†Ô∏è Los clientes de la API (frontend/mobile) deben actualizar sus llamadas para usar los nuevos schemas  
‚ö†Ô∏è El campo `slots` acepta `null` para indicar "sin l√≠mite de cupos"  
‚ö†Ô∏è La ruta de inscripciones usa `/inscripciones` en espa√±ol, no `/inscriptions`

---

## Pr√≥ximos Pasos Recomendados

1. **Testing:** Probar todos los endpoints actualizados con las nuevas estructuras de datos
2. **Documentar el cambio:** Informar al equipo frontend/mobile sobre los cambios en los schemas
3. **Validar:** Verificar que el Swagger UI se cargue correctamente en `/swagger`
4. **Revisar:** Considerar si se necesitan m√°s estados para `ACTIVITY_STATUS` en el futuro

---

## Notas T√©cnicas

- Se mantiene el uso de `ObjectId` de MongoDB en los modelos
- Los arrays de referencias se documentan como arrays de strings (IDs) en Swagger
- El sistema de autenticaci√≥n JWT se mantiene con el esquema `bearerAuth`
- Todos los timestamps (`createdAt`, `updatedAt`) son autom√°ticos de Mongoose

---

## Decisiones Tomadas

1. **Uso de Joi:** Se decidi√≥ mantener Joi como √∫nica librer√≠a de validaci√≥n para todos los schemas
2. **Estados simplificados:** Se mantuvieron solo 2 estados activos seg√∫n constants.js
3. **Nomenclatura en espa√±ol:** Las rutas usan t√©rminos en espa√±ol (`inscripciones`, `voluntarios`, `actividades`)
4. **Slots vs Quota:** Se usa `slots` (del modelo) en lugar de `quota` para consistencia

---

---

## Correcciones Finales

### Ajustes despu√©s de revisi√≥n de rutas reales:

1. **Eliminado endpoint inexistente:**

   - ‚ùå Removido `GET /v1/activity_instance` - Este endpoint no existe en las rutas del proyecto

2. **Reorganizaci√≥n de tags:**

   - `POST /v1/actividades/{activityId}/instancias` movido del tag "Actividades" a "Instancias de Actividades"
   - Corregido par√°metro de path de `id` a `activityId` para coincidir con las rutas reales

3. **Correcci√≥n de rutas de voluntarios:**
   - Actualizado de `/v1/voluntarios` a `/v1/voluntario` (singular)
   - El endpoint `DELETE /v1/voluntario/inscripciones/{inscriptionId}` ahora coincide con la configuraci√≥n en index.js

**Rutas iniciales en index.js (en espa√±ol):**

```javascript
app.use("/", publicRouter); // swagger + ping
app.use("/auth", authRoute); // autenticaci√≥n
app.use("/v1/actividades", activityRoute);
app.use("/v1/organizer", organizerRoute);
app.use("/v1/voluntario", volunteerRoute);
```

4. **Migraci√≥n completa a ingl√©s y plural:**
   - ‚úÖ `/v1/actividades` ‚Üí `/v1/activities`
   - ‚úÖ `/v1/organizer` ‚Üí `/v1/organizers`
   - ‚úÖ `/v1/voluntario` ‚Üí `/v1/volunteers`
   - ‚úÖ `/instancias` ‚Üí `/instances`
   - ‚úÖ `/inscripciones` ‚Üí `/inscriptions`
   - ‚úÖ `/asistencia` ‚Üí `/attendance`

**Rutas finales confirmadas en index.js:**

```javascript
app.use("/", publicRouter); // swagger + ping
app.use("/auth", authRoute); // autenticaci√≥n
app.use("/v1/activities", activityRoute);
app.use("/v1/organizers", organizerRoute);
app.use("/v1/volunteers", volunteerRoute);
```

---

5. **Endpoints de Autenticaci√≥n Actualizados a Ingl√©s:**
   - ‚úÖ `/auth/voluntario/iniciar_sesion` ‚Üí `/auth/volunteers/login`
   - ‚úÖ `/auth/voluntario/registro` ‚Üí `/auth/volunteers/register`
   - ‚úÖ `/auth/organizador/iniciar_sesion` ‚Üí `/auth/organizers/login`
   - ‚úÖ `/auth/organizador/registro` ‚Üí `/auth/organizers/register`

---

## üìã Estructura Final Completa de la API

### Rutas P√∫blicas

```
GET  /ping
GET  /swagger
```

### Autenticaci√≥n: /auth

```
POST /auth/volunteers/login
POST /auth/volunteers/register
POST /auth/organizers/login
POST /auth/organizers/register
```

### Actividades: /v1/activities

```
GET   /v1/activities
POST  /v1/activities
PATCH /v1/activities
```

### Instancias: /v1/activities/{activityId}/instances

```
POST  /v1/activities/{activityId}/instances
PATCH /v1/activities/{activityId}/instances/{instanceId}
```

### Inscripciones

```
POST   /v1/activities/{activityId}/instances/{instanceId}/inscriptions
PATCH  /v1/activities/{activityId}/instances/{instanceId}/inscriptions/{inscriptionId}/attendance
DELETE /v1/volunteers/inscriptions/{inscriptionId}
```

---

**Sesi√≥n completada exitosamente** ‚úì  
**‚ú® API completamente en ingl√©s y consistente en nomenclatura (plural) ‚ú®**
